<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pearson Math Tutor</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-blue-600 text-white p-4 shadow-lg">
        <h1 class="text-2xl font-bold text-center">Pearson Math Tutor</h1>
        <p class="text-center text-blue-100 mt-1">AI-powered math assistance for grades 1-12</p>
    </header>

    <!-- Chat Container -->
    <div id="chat-container" class="flex-1 overflow-y-auto p-4 space-y-4">
        <!-- Welcome Message -->
        <div class="flex justify-start">
            <div class="bg-white rounded-lg p-3 max-w-xs shadow-md">
                <div class="text-sm text-gray-600 mb-1">Bot</div>
                <div class="text-gray-800">Hello! I'm your AI math tutor. I can help you with math problems from grades 1-12. What would you like to learn about today?</div>
            </div>
        </div>
    </div>

    <!-- Thinking Indicator (Hidden by default) -->
    <div id="thinking-indicator" class="hidden px-4 pb-2">
        <div class="flex justify-start">
            <div class="bg-white rounded-lg p-3 max-w-xs shadow-md">
                <div class="text-sm text-gray-600 mb-1">Bot</div>
                <div class="flex items-center space-x-1">
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                    <span class="text-gray-600 ml-2">Thinking...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Input Form -->
    <form id="chat-form" class="p-4 bg-white border-t">
        <div class="flex space-x-2">
            <input 
                type="text" 
                id="message-input" 
                placeholder="Ask a math question..." 
                class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                autocomplete="off"
            >
            <button 
                type="submit" 
                id="send-button" 
                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
            >
                Send
            </button>
        </div>
    </form>

    <script>
        // DOM Elements
        const form = document.getElementById('chat-form');
        const input = document.getElementById('message-input');
        const button = document.getElementById('send-button');
        const chatContainer = document.getElementById('chat-container');
        const thinkingIndicator = document.getElementById('thinking-indicator');

        // API Configuration
        // Auto-detect API URL (works for both local and production)
        const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://127.0.0.1:8000/chat'
            : 'https://a-sample-math-agent-using-rag-4.onrender.com/chat';

        // Event Listeners
        form.addEventListener('submit', handleFormSubmit);

        // Functions
        async function handleFormSubmit(event) {
            event.preventDefault();
            
            const message = input.value.trim();
            if (!message) return;

            // Disable form
            setFormDisabled(true);

            // Add user message
            addMessageToChat('user', message);
            input.value = '';

            // Show thinking indicator
            thinkingIndicator.classList.remove('hidden');
            scrollToBottom();

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                // Hide thinking indicator
                thinkingIndicator.classList.add('hidden');
                
                // Add bot response
                addMessageToChat('bot', data.answer);

            } catch (error) {
                console.error('Error:', error);
                
                // Hide thinking indicator
                thinkingIndicator.classList.add('hidden');
                
                // Add error message
                const errorMessage = `Sorry, I encountered an error: ${error.message}`;
                addMessageToChat('bot-error', errorMessage);
            } finally {
                // Re-enable form
                setFormDisabled(false);
                input.focus();
            }
        }

        function addMessageToChat(sender, text) {
            const messageDiv = document.createElement('div');
            
            // Sanitize text (basic)
            const sanitizedText = text.replace(/</g, '&lt;').replace(/>/g, '&gt;');
            
            if (sender === 'user') {
                messageDiv.className = 'flex justify-end';
                messageDiv.innerHTML = `
                    <div class="bg-blue-600 text-white rounded-lg p-3 max-w-xs shadow-md">
                        <div class="text-sm text-blue-100 mb-1">You</div>
                        <div>${sanitizedText}</div>
                    </div>
                `;
            } else if (sender === 'bot') {
                messageDiv.className = 'flex justify-start';
                messageDiv.innerHTML = `
                    <div class="bg-white rounded-lg p-3 max-w-xs shadow-md">
                        <div class="text-sm text-gray-600 mb-1">Bot</div>
                        <div class="text-gray-800">${sanitizedText}</div>
                    </div>
                `;
            } else if (sender === 'bot-error') {
                messageDiv.className = 'flex justify-start';
                messageDiv.innerHTML = `
                    <div class="bg-red-100 border border-red-300 rounded-lg p-3 max-w-xs shadow-md">
                        <div class="text-sm text-red-600 mb-1">Bot</div>
                        <div class="text-red-800">${sanitizedText}</div>
                    </div>
                `;
            }
            
            chatContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function setFormDisabled(disabled) {
            input.disabled = disabled;
            button.disabled = disabled;
            
            if (disabled) {
                button.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                button.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // Focus input on page load
        input.focus();
    </script>
</body>
</html>

